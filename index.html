<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasta Luego - Mini Jeu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            overflow: hidden;
            background: #000;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #1a4d6d;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 40px;
            border: 4px solid #ff6b35;
            text-align: center;
            font-size: 14px;
            line-height: 1.8;
            max-width: 600px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .highlight {
            color: #ffcc00;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        #startBanner {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="startBanner" class="banner">
        À l'aide des touches directionnelles,<br>
        emmène ton bateau à bon port !<br><br>
        <span class="highlight">ESPACE pour commencer</span>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 800;
        canvas.height = 600;

        // Game state
        let gameState = 'start';
        let score = 0;
        let obstaclesAvoided = 0;
        let boat = { x: canvas.width / 2, y: canvas.height * 0.66, width: 40, height: 50, speed: 4 };
        let obstacles = [];
        let scrollY = 0;
        let scrollSpeed = 2;
        let keys = {};
        let startTime = Date.now();
        let autoStartTimer = null;
        let port = { x: canvas.width / 2, y: -200, width: 60, height: 60 };
        let gameWon = false;

        // Audio
        let audio = new Audio('hasta_luego.mp3');
        audio.loop = true;
        audio.volume = 0.5;

        // Try to load audio, but continue even if it fails
        audio.addEventListener('error', function() {
            console.log('Audio file not found, continuing without music');
        });

        // Water wave effect
        let waveOffset = 0;

        function drawWater() {
            const waveHeight = 8;
            const waveFrequency = 0.02;
            
            for (let y = 0; y < canvas.height; y += 16) {
                for (let x = 0; x < canvas.width; x += 16) {
                    const wave = Math.sin((x + y + waveOffset + scrollY) * waveFrequency) * waveHeight;
                    const brightness = 26 + Math.floor(wave);
                    ctx.fillStyle = `rgb(${brightness}, ${77 + Math.floor(wave / 2)}, ${109 + Math.floor(wave / 3)})`;
                    ctx.fillRect(x, y, 16, 16);
                }
            }
            waveOffset += 0.5;
        }

        function drawBoat() {
            // Hull
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(boat.x - 15, boat.y + 10, 30, 20);
            ctx.fillRect(boat.x - 12, boat.y + 30, 24, 8);
            
            // Mast
            ctx.fillStyle = '#5C4033';
            ctx.fillRect(boat.x - 2, boat.y - 10, 4, 20);
            
            // Sail
            ctx.fillStyle = '#F5E6D3';
            ctx.beginPath();
            ctx.moveTo(boat.x, boat.y - 10);
            ctx.lineTo(boat.x + 18, boat.y + 5);
            ctx.lineTo(boat.x, boat.y + 10);
            ctx.closePath();
            ctx.fill();
            
            // Sail outline
            ctx.strokeStyle = '#5C4033';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawObstacle(obs) {
            // Brown rock with pixel art style
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(obs.x - 30, obs.y - 15, 40, 30);
            
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(obs.x - 15, obs.y - 10, 15, 15);
            ctx.fillRect(obs.x + 5, obs.y - 8, 12, 12);
            
            ctx.fillStyle = '#D2691E';
            ctx.fillRect(obs.x - 10, obs.y - 5, 8, 8);
            ctx.fillRect(obs.x + 8, obs.y, 6, 6);
        }

        function drawPort() {
            // Flag pole
            ctx.fillStyle = '#5C4033';
            ctx.fillRect(port.x - 2, port.y, 4, 40);
            
            // Yellow flag
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(port.x + 2, port.y, 25, 15);
            
            // Text above
            ctx.fillStyle = '#FFF';
            ctx.font = '12px "Press Start 2P", monospace';
            ctx.textAlign = 'center';
            ctx.fillText('PO(R)T DE', port.x + 15, port.y - 15);
            ctx.fillText('DEPART', port.x + 15, port.y - 2);
        }

        function createObstacle() {
            const minX = canvas.width * 0.05;
            const maxX = canvas.width * 0.95;
            obstacles.push({
                x: minX + Math.random() * (maxX - minX),
                y: -30,
                width: 40,
                height: 30
            });
        }

        function updateGame() {
            if (gameState !== 'playing' && gameState !== 'winning') return;

            // Move boat
            if (keys['ArrowLeft'] && boat.x > 30) boat.x -= boat.speed;
            if (keys['ArrowRight'] && boat.x < canvas.width - 30) boat.x += boat.speed;
            if (keys['ArrowUp'] && boat.y > 30) boat.y -= boat.speed;
            if (keys['ArrowDown'] && boat.y < canvas.height - 30) boat.y += boat.speed;

            if (gameState === 'playing') {
                // Spawn obstacles
                if (obstaclesAvoided < 30 && Math.random() < 0.015) {
                    createObstacle();
                }

                // Update obstacles
                obstacles.forEach((obs, index) => {
                    obs.y += scrollSpeed + 1;
                    
                    // Check collision
                    if (Math.abs(boat.x - obs.x) < 25 && Math.abs(boat.y - obs.y) < 30) {
                        gameState = 'crashed';
                        showCrashBanner();
                    }

                    // Remove off-screen obstacles
                    if (obs.y > canvas.height + 50) {
                        obstacles.splice(index, 1);
                        obstaclesAvoided++;
                        
                        // Win condition
                        if (obstaclesAvoided >= 30) {
                            gameState = 'winning';
                            port.y = boat.y - 300;
                        }
                    }
                });

                scrollY += scrollSpeed;
            } else if (gameState === 'winning') {
                // Move boat towards port
                boat.y -= 2;
                
                if (boat.y < port.y + 30) {
                    gameState = 'won';
                    showWinBanner();
                }
            }
        }

        function drawGame() {
            drawWater();
            
            if (gameState === 'playing' || gameState === 'winning') {
                obstacles.forEach(drawObstacle);
            }
            
            if (gameState === 'winning' || gameState === 'won') {
                drawPort();
            }
            
            drawBoat();

            // Score
            if (gameState === 'playing') {
                ctx.fillStyle = '#FFF';
                ctx.font = '14px "Press Start 2P", monospace';
                ctx.textAlign = 'left';
                ctx.fillText(`Obstacles: ${obstaclesAvoided}/30`, 30, 30);
            }
        }

        function showCrashBanner() {
            const banner = document.createElement('div');
            banner.className = 'banner';
            banner.innerHTML = 'Tu t\'es échoué !<br>Tu dois sûrement être un quanti…<br><br><span class="highlight">Redémarrage...</span>';
            document.body.appendChild(banner);
            
            setTimeout(() => {
                document.body.removeChild(banner);
                resetGame();
                gameState = 'playing';
            }, 3000);
        }

        function showWinBanner() {
            const banner = document.createElement('div');
            banner.className = 'banner';
            banner.innerHTML = `
                Bien joué !<br><br>
                Après 7 ans dans le même bateau,<br>
                je vais changer d'équipage et quitter<br>
                Harris pour une autre aventure.<br><br>
                Tu as prouvé ta valeur aujourd'hui ;<br>
                je t'invite à rejoindre de la même façon<br>
                mon pot de départ le<br>
                <span class="highlight">jeudi 6 novembre</span>,<br>
                à la cafèt, avant de se déhaler<br>
                vers une autre destination plus festive !
            `;
            document.body.appendChild(banner);
        }

        function resetGame() {
            boat.x = canvas.width / 2;
            boat.y = canvas.height * 0.66;
            obstacles = [];
            scrollY = 0;
            obstaclesAvoided = 0;
            port.y = -200;
        }

        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === ' ' && gameState === 'start') {
                startGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function startGame() {
            const startBanner = document.getElementById('startBanner');
            if (startBanner) {
                document.body.removeChild(startBanner);
            }
            if (autoStartTimer) {
                clearTimeout(autoStartTimer);
            }
            gameState = 'playing';
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        // Auto-start after 8 seconds
        autoStartTimer = setTimeout(() => {
            if (gameState === 'start') {
                startGame();
            }
        }, 8000);

        // Start music immediately
        audio.play().catch(e => console.log('Audio play failed:', e));

        // Start game loop
        gameLoop();
    </script>
</body>
</html>
