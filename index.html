<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasta Luego - Mini Jeu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #1a4d6d 0%, #0d2636 100%);
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
        }

        canvas {
            border: 4px solid #2a5f7f;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            background: #1e5a7a;
        }

        .banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 4px solid #fff;
            padding: 40px;
            text-align: center;
            color: #fff;
            font-size: 18px;
            line-height: 1.6;
            max-width: 600px;
            z-index: 10;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }

        .banner.hidden {
            display: none;
        }

        .banner h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #ffd700;
        }

        .banner .highlight {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 22px;
            text-decoration: underline;
        }

        .banner .space-prompt {
            margin-top: 20px;
            font-size: 16px;
            color: #ffd700;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="startBanner" class="banner">
            <h2>Hasta Luego</h2>
            <p>À l'aide des touches directionnelles,<br>emmène ton bateau à bon port !</p>
            <p class="space-prompt">ESPACE pour commencer</p>
        </div>
        <div id="collisionBanner" class="banner hidden"></div>
        <div id="victoryBanner" class="banner hidden"></div>
    </div>

    <audio id="bgMusic" loop>
        <source src="hasta_luego.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const bgMusic = document.getElementById('bgMusic');
        const startBanner = document.getElementById('startBanner');
        const collisionBanner = document.getElementById('collisionBanner');
        const victoryBanner = document.getElementById('victoryBanner');

        // Game state
        let gameState = 'start'; // 'start', 'playing', 'collision', 'victory'
        let gameStarted = false;
        let autoStartTimer = null;
        let obstaclesCleared = 0;
        const OBSTACLES_TO_WIN = 12;

        // Boat
        const boat = {
            x: 400,
            y: 450,
            width: 40,
            height: 60,
            speed: 4
        };

        // Obstacles
        let obstacles = [];
        let obstacleTimer = 0;
        const OBSTACLE_INTERVAL = 90; // frames between obstacles

        // Background scroll
        let scrollY = 0;
        let scrollSpeed = 2;

        // Wave animation
        let waveOffset = 0;

        // Port flag
        const port = {
            x: 400,
            y: -100,
            visible: false
        };

        // Input
        const keys = {};

        // Start music and auto-start timer
        bgMusic.play().catch(e => console.log('Audio autoplay blocked'));
        
        autoStartTimer = setTimeout(() => {
            if (gameState === 'start') {
                startGame();
            }
        }, 8000);

        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameState === 'start') {
                    clearTimeout(autoStartTimer);
                    startGame();
                } else if (gameState === 'collision') {
                    restartGame();
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        function startGame() {
            gameState = 'playing';
            gameStarted = true;
            startBanner.classList.add('hidden');
            bgMusic.play().catch(e => console.log('Audio play failed'));
        }

        function restartGame() {
            gameState = 'playing';
            boat.x = 400;
            boat.y = 450;
            obstacles = [];
            obstaclesCleared = 0;
            obstacleTimer = 0;
            scrollY = 0;
            scrollSpeed = 2;
            port.visible = false;
            port.y = -100;
            collisionBanner.classList.add('hidden');
        }

        function showCollision(message) {
            gameState = 'collision';
            collisionBanner.innerHTML = `<h2>Oups !</h2><p>${message}</p><p class="space-prompt">ESPACE pour recommencer</p>`;
            collisionBanner.classList.remove('hidden');
        }

        function showVictory() {
            gameState = 'victory';
            scrollSpeed = 0;
            victoryBanner.innerHTML = `
                <h2>Bien joué !</h2>
                <p>Après 7 ans dans le même bateau,<br>je vais changer d'équipage et quitter Harris<br>pour une autre aventure.</p>
                <p style="margin-top: 20px;">Tu as prouvé ta valeur aujourd'hui ;<br>je t'invite à rejoindre de la même façon mon pot de départ<br>le <span class="highlight">jeudi 6 novembre</span>, à la cafèt,<br>avant de se déhaler vers une autre destination plus festive !</p>
            `;
            victoryBanner.classList.remove('hidden');
        }

        // Draw functions
        function drawOcean() {
            // Base ocean
            ctx.fillStyle = '#1e5a7a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Waves
            const waveColors = ['#2a6f8f', '#246b8a', '#1e5a7a'];
            for (let i = 0; i < 3; i++) {
                ctx.fillStyle = waveColors[i];
                for (let y = 0; y < canvas.height; y += 20) {
                    for (let x = 0; x < canvas.width; x += 30) {
                        const offsetY = (y + scrollY + waveOffset * (i + 1)) % canvas.height;
                        const offsetX = x + Math.sin((y + scrollY) * 0.02 + i) * 10;
                        if (Math.random() > 0.7) {
                            ctx.fillRect(offsetX, offsetY, 8, 4);
                        }
                    }
                }
            }
        }

        function drawBoat() {
            // Hull
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(boat.x - 15, boat.y + 10, 30, 25);
            
            // Sail
            ctx.fillStyle = '#F5F5DC';
            ctx.beginPath();
            ctx.moveTo(boat.x, boat.y - 20);
            ctx.lineTo(boat.x - 20, boat.y + 10);
            ctx.lineTo(boat.x + 20, boat.y + 10);
            ctx.closePath();
            ctx.fill();
            
            // Mast
            ctx.fillStyle = '#654321';
            ctx.fillRect(boat.x - 2, boat.y - 20, 4, 50);
        }

        function drawRock(x, y) {
            ctx.fillStyle = '#8B6914';
            ctx.fillRect(x - 20, y - 15, 40, 30);
            ctx.fillStyle = '#A0752C';
            ctx.fillRect(x - 15, y - 10, 30, 20);
            ctx.fillStyle = '#6B5410';
            ctx.fillRect(x - 10, y - 5, 20, 10);
        }

        function drawRedBuoy(x, y) {
            ctx.fillStyle = '#DC143C';
            ctx.fillRect(x - 12, y - 12, 24, 24);
            ctx.fillStyle = '#B22222';
            ctx.fillRect(x - 8, y - 8, 16, 16);
        }

        function drawGreenBuoy(x, y) {
            ctx.fillStyle = '#32CD32';
            ctx.beginPath();
            ctx.moveTo(x, y - 15);
            ctx.lineTo(x - 15, y + 15);
            ctx.lineTo(x + 15, y + 15);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(x, y - 10);
            ctx.lineTo(x - 10, y + 10);
            ctx.lineTo(x + 10, y + 10);
            ctx.closePath();
            ctx.fill();
        }

        function drawPort() {
            if (!port.visible) return;
            
            // Flag pole
            ctx.fillStyle = '#654321';
            ctx.fillRect(port.x - 2, port.y - 40, 4, 60);
            
            // Yellow flag
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(port.x, port.y - 35, 30, 20);
            
            // Text
            ctx.fillStyle = '#000';
            ctx.font = 'bold 12px Courier New';
            ctx.fillText('po(r)t de départ', port.x - 50, port.y - 50);
        }

        function createObstacle() {
            const type = Math.random();
            let obstacle;
            
            if (type < 0.33) {
                // Rock (center)
                obstacle = {
                    type: 'rock',
                    x: 200 + Math.random() * 400,
                    y: -50,
                    width: 40,
                    height: 30
                };
            } else if (type < 0.66) {
                // Red buoy (left side)
                obstacle = {
                    type: 'redBuoy',
                    x: 240 + Math.random() * 200,
                    y: -50,
                    width: 24,
                    height: 24
                };
            } else {
                // Green buoy (right side)
                obstacle = {
                    type: 'greenBuoy',
                    x: 360 + Math.random() * 200,
                    y: -50,
                    width: 30,
                    height: 30
                };
            }
            
            obstacles.push(obstacle);
        }

        function updateObstacles() {
            obstacles.forEach((obs, index) => {
                obs.y += scrollSpeed + 2;
                
                // Remove off-screen obstacles
                if (obs.y > canvas.height + 50) {
                    obstacles.splice(index, 1);
                    obstaclesCleared++;
                    
                    // Check if won
                    if (obstaclesCleared >= OBSTACLES_TO_WIN) {
                        port.visible = true;
                        scrollSpeed = 3;
                        boat.y -= 1; // Move boat up slowly
                    }
                }
            });
            
            // Create new obstacles
            if (gameState === 'playing' && obstaclesCleared < OBSTACLES_TO_WIN) {
                obstacleTimer++;
                if (obstacleTimer >= OBSTACLE_INTERVAL) {
                    createObstacle();
                    obstacleTimer = 0;
                }
            }
        }

        function checkCollisions() {
            obstacles.forEach(obs => {
                const boatLeft = boat.x - 15;
                const boatRight = boat.x + 15;
                const boatTop = boat.y - 20;
                const boatBottom = boat.y + 35;
                
                const obsLeft = obs.x - obs.width / 2;
                const obsRight = obs.x + obs.width / 2;
                const obsTop = obs.y - obs.height / 2;
                const obsBottom = obs.y + obs.height / 2;
                
                // Check overlap
                if (boatRight > obsLeft && boatLeft < obsRight &&
                    boatBottom > obsTop && boatTop < obsBottom) {
                    
                    if (obs.type === 'rock') {
                        showCollision("Tu t'es échoué ! Tu dois sûrement être un quanti…");
                    } else if (obs.type === 'redBuoy') {
                        // Check if passed on left (collision)
                        if (boat.x < obs.x) {
                            showCollision("On doit passer à droite des bouées bâbord rouges ! Marin d'eau douce !");
                        }
                    } else if (obs.type === 'greenBuoy') {
                        // Check if passed on right (collision)
                        if (boat.x > obs.x) {
                            showCollision("On doit passer à gauche des bouées tribord vertes ! Même Fred !");
                        }
                    }
                }
            });
            
            // Check port collision
            if (port.visible && boat.y < port.y + 20 && 
                Math.abs(boat.x - port.x) < 40) {
                showVictory();
            }
        }

        function updateBoat() {
            if (keys['ArrowLeft'] || keys['KeyA']) {
                boat.x -= boat.speed;
            }
            if (keys['ArrowRight'] || keys['KeyD']) {
                boat.x += boat.speed;
            }
            if (keys['ArrowUp'] || keys['KeyW']) {
                boat.y -= boat.speed;
            }
            if (keys['ArrowDown'] || keys['KeyS']) {
                boat.y += boat.speed;
            }
            
            // Keep boat in bounds
            boat.x = Math.max(30, Math.min(canvas.width - 30, boat.x));
            
            if (port.visible) {
                boat.y = Math.max(50, Math.min(canvas.height - 50, boat.y));
            } else {
                boat.y = Math.max(150, Math.min(canvas.height - 50, boat.y));
            }
        }

        function updatePort() {
            if (port.visible && port.y < 100) {
                port.y += 2;
            }
        }

        function gameLoop() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw ocean
            drawOcean();
            
            if (gameState === 'playing') {
                // Update
                waveOffset += 0.05;
                scrollY += scrollSpeed;
                updateBoat();
                updateObstacles();
                updatePort();
                checkCollisions();
            }
            
            // Draw obstacles
            obstacles.forEach(obs => {
                if (obs.type === 'rock') drawRock(obs.x, obs.y);
                else if (obs.type === 'redBuoy') drawRedBuoy(obs.x, obs.y);
                else if (obs.type === 'greenBuoy') drawGreenBuoy(obs.x, obs.y);
            });
            
            // Draw port
            drawPort();
            
            // Draw boat
            drawBoat();
            
            requestAnimationFrame(gameLoop);
        }

        // Start game loop
        gameLoop();
    </script>
</body>
</html>
