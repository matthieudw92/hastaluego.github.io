<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HastaLuego - Jusqu'au port de d√©part</title>
    <style>
        @font-face {
            font-family: 'PixelFont';
            src: url('data:font/woff2;base64,d09GMgABAAAAAAQkAA0AAAAAB+AAAAPWAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbEBwaBmAAgTIBNgIkAxgEBgWDGAcbGwjIngXYY/lIo6EXumG5RMN+ESo5D/+/37d9zrtjkskkmUeSaCJZPJJYIdFEhkQn6V+ESlYlk98AgGuumVmAB3zQ/+7N/yLYTEjKfRVWB54lrb7B0s5adUkWaSDYLlELbILJH+hMJ7p8TkKpE82DBx5owIEGlnEH/gCvAOMGtsE4g3EA4wDGnQBMZe+8Llq1tQvxgKuX7hWxKxYVuy9WdMX2AHks3lcskQO1xaZCBOL5+Xd+KEWqJDX9Cvwa/nw8SJPcBeDZvx9/CKdKUWX2x8z/f0AJAMAAYAAy') format('woff2');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            overflow: hidden;
            background: #000;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #1e4d7b;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 4px solid #fff;
            padding: 30px 40px;
            color: #fff;
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
            max-width: 600px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .highlight {
            color: #ffeb3b;
            font-weight: bold;
            font-size: 22px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <audio id="bgMusic" loop>
        <source src="hasta_luego.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const music = document.getElementById('bgMusic');

        canvas.width = 800;
        canvas.height = 600;

        let gameState = 'intro';
        let boat = { x: 400, y: 450, width: 40, height: 50, speed: 4 };
        let obstacles = [];
        let obstaclesPassed = 0;
        let bgScroll = 0;
        let flagY = -200;
        let keys = {};
        let introTimer = 0;
        let gameStartTime = 0;

        // Musique
        music.volume = 0.5;
        music.play().catch(() => {});

        // Gestion des touches
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && gameState === 'intro') {
                startGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function showBanner(text) {
            const banner = document.createElement('div');
            banner.className = 'banner';
            banner.innerHTML = text;
            document.body.appendChild(banner);
            return banner;
        }

        function startGame() {
            gameState = 'playing';
            obstacles = [];
            obstaclesPassed = 0;
            bgScroll = 0;
            boat.x = 400;
            boat.y = 450;
            flagY = -200;
            gameStartTime = Date.now();
            document.querySelectorAll('.banner').forEach(b => b.remove());
            spawnObstacle();
        }

        function gameOver(message) {
            gameState = 'gameover';
            const banner = showBanner(message + '<br><br>Appuie sur ESPACE pour recommencer');
            setTimeout(() => {
                document.addEventListener('keydown', function restart(e) {
                    if (e.key === ' ') {
                        document.removeEventListener('keydown', restart);
                        startGame();
                    }
                });
            }, 100);
        }

        function victory() {
            gameState = 'victory';
            const banner = showBanner(`
                <div style="font-size: 24px; margin-bottom: 20px;">üéâ Bien jou√© ! üéâ</div>
                <div style="font-size: 16px; line-height: 1.8;">
                    Apr√®s 7 ans dans le m√™me bateau, je vais changer d'√©quipage<br>
                    et quitter Harris pour une autre aventure.<br><br>
                    Tu as prouv√© ta valeur aujourd'hui ; je t'invite √† rejoindre<br>
                    de la m√™me fa√ßon mon pot de d√©part le <span class="highlight">jeudi 6 novembre</span>,<br>
                    √† la caf√®t, avant de se d√©haler vers une autre destination plus festive !
                </div>
            `);
        }

        function spawnObstacle() {
            if (obstaclesPassed >= 12) return;

            const types = ['rock', 'red', 'green'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let x;
            if (type === 'rock') {
                x = 200 + Math.random() * 400; // 25%-75%
            } else if (type === 'red') {
                x = 240 + Math.random() * 200; // 30%-55%
            } else {
                x = 360 + Math.random() * 200; // 45%-70%
            }

            obstacles.push({
                type: type,
                x: x,
                y: -50,
                width: type === 'rock' ? 60 : 30,
                height: type === 'rock' ? 40 : 30
            });

            setTimeout(() => spawnObstacle(), 2000 + Math.random() * 1000);
        }

        function checkCollision(boat, obstacle) {
            return boat.x < obstacle.x + obstacle.width &&
                   boat.x + boat.width > obstacle.x &&
                   boat.y < obstacle.y + obstacle.height &&
                   boat.y + boat.height > obstacle.y;
        }

        function drawPixelRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x), Math.floor(y), w, h);
        }

        function drawBoat(x, y) {
            // Coque
            ctx.fillStyle = '#654321';
            ctx.fillRect(x, y + 30, 40, 20);
            // Voile
            ctx.fillStyle = '#f5f5dc';
            ctx.beginPath();
            ctx.moveTo(x + 20, y);
            ctx.lineTo(x + 35, y + 30);
            ctx.lineTo(x + 5, y + 30);
            ctx.closePath();
            ctx.fill();
            // M√¢t
            ctx.fillStyle = '#654321';
            ctx.fillRect(x + 18, y, 4, 50);
        }

        function drawRock(x, y) {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + 10, y + 10, 40, 30);
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(x + 15, y + 5, 35, 25);
            ctx.fillStyle = '#CD853F';
            ctx.fillRect(x + 20, y, 30, 20);
        }

        function drawRedBuoy(x, y) {
            ctx.fillStyle = '#8B0000';
            ctx.fillRect(x + 2, y + 2, 26, 26);
            ctx.fillStyle = '#DC143C';
            ctx.fillRect(x, y, 30, 30);
        }

        function drawGreenBuoy(x, y) {
            ctx.fillStyle = '#006400';
            ctx.beginPath();
            ctx.moveTo(x + 15, y);
            ctx.lineTo(x + 30, y + 30);
            ctx.lineTo(x, y + 30);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(x + 15, y + 3);
            ctx.lineTo(x + 27, y + 27);
            ctx.lineTo(x + 3, y + 27);
            ctx.closePath();
            ctx.fill();
        }

        function drawWaves() {
            for (let y = 0; y < canvas.height + 40; y += 40) {
                for (let x = 0; x < canvas.width; x += 80) {
                    const offsetY = (y + bgScroll) % 40;
                    ctx.fillStyle = y % 80 === 0 ? '#2563a8' : '#1e4d7b';
                    ctx.fillRect(x, offsetY - 40, 40, 20);
                    ctx.fillRect(x + 40, offsetY - 20, 40, 20);
                }
            }
        }

        function drawFlag() {
            // M√¢t
            ctx.fillStyle = '#654321';
            ctx.fillRect(388, flagY, 4, 30);
            // Drapeau
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(392, flagY, 20, 15);
            // Texte
            ctx.fillStyle = '#000';
            ctx.font = 'bold 10px Courier New';
            ctx.fillText('PO(R)T DE', 340, flagY - 10);
            ctx.fillText('D√âPART', 345, flagY + 5);
        }

        function update() {
            if (gameState === 'intro') {
                introTimer += 1/60;
                if (introTimer >= 8) {
                    startGame();
                }
                return;
            }

            if (gameState !== 'playing') return;

            // D√©placement du bateau
            if (keys['ArrowLeft'] && boat.x > 50) boat.x -= boat.speed;
            if (keys['ArrowRight'] && boat.x < canvas.width - boat.width - 50) boat.x += boat.speed;

            // Scroll de l'arri√®re-plan
            bgScroll += 2;
            if (bgScroll >= 40) bgScroll = 0;

            // Mouvement des obstacles
            obstacles.forEach((obs, index) => {
                obs.y += 3;

                if (obs.y > canvas.height) {
                    obstacles.splice(index, 1);
                    obstaclesPassed++;
                }

                // Collision
                if (checkCollision(boat, obs)) {
                    if (obs.type === 'rock') {
                        gameOver('Tu t\'es √©chou√© ! Tu dois s√ªrement √™tre un quanti‚Ä¶');
                    }
                }

                // V√©rification r√®gles de navigation
                if (obs.type === 'red' && boat.y < obs.y + obs.height && boat.y + boat.height > obs.y) {
                    if (boat.x < obs.x) {
                        gameOver('On doit passer √† droite des bou√©es b√¢bord rouges ! Marin d\'eau douce !');
                    }
                }

                if (obs.type === 'green' && boat.y < obs.y + obs.height && boat.y + boat.height > obs.y) {
                    if (boat.x + boat.width > obs.x + obs.width) {
                        gameOver('On doit passer √† gauche des bou√©es tribord vertes ! M√™me Fred !');
                    }
                }
            });

            // Arriv√©e
            if (obstaclesPassed >= 12) {
                boat.y -= 3;
                flagY += 3;
                
                if (boat.y < flagY + 30 && boat.x > 360 && boat.x < 420) {
                    victory();
                }
            }
        }

        function draw() {
            // Arri√®re-plan
            drawWaves();

            // Obstacles
            obstacles.forEach(obs => {
                if (obs.type === 'rock') drawRock(obs.x, obs.y);
                else if (obs.type === 'red') drawRedBuoy(obs.x, obs.y);
                else if (obs.type === 'green') drawGreenBuoy(obs.x, obs.y);
            });

            // Drapeau d'arriv√©e
            if (obstaclesPassed >= 12) {
                drawFlag();
            }

            // Bateau
            drawBoat(boat.x, boat.y);
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Intro
        showBanner(`
            √Ä l'aide des touches directionnelles,<br>
            emm√®ne ton bateau √† bon port !<br><br>
            <strong>ESPACE pour commencer</strong>
        `);

        gameLoop();
    </script>
</body>
</html>
