<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HastaLuego - Jeu de Navigation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #gameCanvas {
            border: 4px solid #333;
            cursor: none;
            display: block;
        }
        
        .game-container {
            position: relative;
        }
        
        .banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            text-align: center;
            border: 3px solid #fff;
            border-radius: 10px;
            z-index: 10;
            max-width: 500px;
            line-height: 1.8;
        }
        
        .banner h2 {
            color: #ffff00;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .banner p {
            font-size: 10px;
            margin: 15px 0;
        }
        
        .banner .highlight {
            color: #ff0;
            font-size: 14px;
            text-decoration: underline;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .banner .space-instruction {
            color: #0ff;
            margin-top: 20px;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="800"></canvas>
        <div id="startBanner" class="banner">
            <h2>HASTA LUEGO</h2>
            <p>À l'aide des touches directionnelles,<br>emmène ton bateau à bon port !</p>
            <p class="space-instruction">ESPACE pour commencer</p>
        </div>
        <div id="collisionBanner" class="banner hidden"></div>
        <div id="endBanner" class="banner hidden">
            <h2>Bien joué !</h2>
            <p>Après 7 ans dans le même bateau, je vais changer d'équipage et quitter Harris pour une autre aventure.</p>
            <p>Tu as prouvé ta valeur aujourd'hui ; je t'invite à rejoindre de la même façon mon pot de départ le <span class="highlight">jeudi 6 novembre</span>, à la cafèt, avant de se déhaler vers une autre destination plus festive !</p>
        </div>
        <audio id="bgMusic" loop>
            <source src="hasta-luego.mp3" type="audio/mpeg">
        </audio>
    </div>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;
        
        // Game state
        let gameState = 'START';
        let obstacleCount = 0;
        let obstaclesPassed = 0;
        let waveOffset = 0;
        let autoStartTimer = null;
        
        // Player boat
        const boat = {
            x: canvas.width / 2,
            y: canvas.height * 0.67,
            width: 40,
            height: 50,
            speed: 4
        };
        
        // Obstacles array
        let obstacles = [];
        
        // Keys pressed
        const keys = {};
        
        // Wave animation
        let wavePhase = 0;
        
        // Flag position
        const flag = {
            x: canvas.width / 2,
            y: -100,
            width: 60,
            height: 80,
            visible: false
        };
        
        // Music control
        const bgMusic = document.getElementById('bgMusic');
        
        // Start game
        function startGame() {
            if (autoStartTimer) {
                clearTimeout(autoStartTimer);
                autoStartTimer = null;
            }
            
            gameState = 'PLAYING';
            document.getElementById('startBanner').classList.add('hidden');
            document.getElementById('collisionBanner').classList.add('hidden');
            document.getElementById('endBanner').classList.add('hidden');
            
            // Reset game
            boat.x = canvas.width / 2;
            boat.y = canvas.height * 0.67;
            obstacles = [];
            obstacleCount = 0;
            obstaclesPassed = 0;
            flag.visible = false;
            flag.y = -100;
            
            // Try to play music
            bgMusic.play().catch(e => console.log('Music autoplay prevented'));
        }
        
        // Draw functions
        function drawSea() {
            // Draw base sea
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#2a5f8c');
            gradient.addColorStop(1, '#1a3a5c');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw animated waves
            ctx.strokeStyle = '#3a7fac';
            ctx.lineWidth = 2;
            
            for (let y = waveOffset % 40; y < canvas.height; y += 40) {
                ctx.beginPath();
                for (let x = 0; x <= canvas.width; x += 10) {
                    const waveY = y + Math.sin((x + wavePhase) * 0.02) * 5;
                    if (x === 0) {
                        ctx.moveTo(x, waveY);
                    } else {
                        ctx.lineTo(x, waveY);
                    }
                }
                ctx.stroke();
            }
            
            wavePhase += 2;
            waveOffset += 1;
        }
        
        function drawBoat(x, y) {
            // Hull
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.moveTo(x - 20, y + 10);
            ctx.lineTo(x + 20, y + 10);
            ctx.lineTo(x + 15, y + 25);
            ctx.lineTo(x - 15, y + 25);
            ctx.closePath();
            ctx.fill();
            
            // Mast
            ctx.fillStyle = '#654321';
            ctx.fillRect(x - 2, y - 20, 4, 30);
            
            // Sail
            ctx.fillStyle = '#f5deb3';
            ctx.beginPath();
            ctx.moveTo(x + 2, y - 15);
            ctx.lineTo(x + 18, y - 5);
            ctx.lineTo(x + 18, y + 5);
            ctx.lineTo(x + 2, y + 5);
            ctx.closePath();
            ctx.fill();
            
            // Outline
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawRock(x, y) {
            ctx.fillStyle = '#8b7355';
            ctx.fillRect(x - 25, y - 20, 50, 40);
            
            // Add texture
            ctx.fillStyle = '#6b5335';
            ctx.fillRect(x - 20, y - 15, 10, 10);
            ctx.fillRect(x + 5, y - 10, 8, 8);
            ctx.fillRect(x - 10, y + 5, 12, 8);
            
            ctx.fillStyle = '#9b8365';
            ctx.fillRect(x - 15, y - 10, 5, 5);
            ctx.fillRect(x + 10, y + 5, 6, 6);
        }
        
        function drawRedBuoy(x, y) {
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(x - 15, y - 15, 30, 30);
            
            // Add highlight
            ctx.fillStyle = '#ff6666';
            ctx.fillRect(x - 12, y - 12, 8, 8);
            
            // Border
            ctx.strokeStyle = '#8b0000';
            ctx.lineWidth = 2;
            ctx.strokeRect(x - 15, y - 15, 30, 30);
        }
        
        function drawGreenBuoy(x, y) {
            ctx.fillStyle = '#00ff00';
            ctx.beginPath();
            ctx.moveTo(x, y - 20);
            ctx.lineTo(x - 20, y + 15);
            ctx.lineTo(x + 20, y + 15);
            ctx.closePath();
            ctx.fill();
            
            // Add highlight
            ctx.fillStyle = '#66ff66';
            ctx.beginPath();
            ctx.moveTo(x, y - 15);
            ctx.lineTo(x - 8, y);
            ctx.lineTo(x + 8, y);
            ctx.closePath();
            ctx.fill();
            
            // Border
            ctx.strokeStyle = '#008b00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y - 20);
            ctx.lineTo(x - 20, y + 15);
            ctx.lineTo(x + 20, y + 15);
            ctx.closePath();
            ctx.stroke();
        }
        
        function drawFlag() {
            if (!flag.visible) return;
            
            // Pole
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(flag.x - 2, flag.y - 30, 4, 60);
            
            // Flag
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(flag.x + 2, flag.y - 25, 40, 30);
            
            // Text above flag
            ctx.fillStyle = '#000';
            ctx.font = 'bold 10px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillText('PO(R)T DE', flag.x + 22, flag.y - 35);
            ctx.fillText('DÉPART', flag.x + 22, flag.y - 45);
        }
        
        // Create obstacles
        function createObstacle() {
            if (obstacleCount >= 12) return;
            
            const types = ['rock', 'redBuoy', 'greenBuoy'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let x;
            if (type === 'rock') {
                x = canvas.width * (0.25 + Math.random() * 0.5);
            } else if (type === 'redBuoy') {
                x = canvas.width * (0.3 + Math.random() * 0.25);
            } else {
                x = canvas.width * (0.45 + Math.random() * 0.25);
            }
            
            obstacles.push({
                type: type,
                x: x,
                y: -50,
                width: type === 'rock' ? 50 : 30,
                height: type === 'rock' ? 40 : 30
            });
            
            obstacleCount++;
        }
        
        // Collision detection
        function checkCollision() {
            const boatLeft = boat.x - boat.width / 2;
            const boatRight = boat.x + boat.width / 2;
            const boatTop = boat.y - boat.height / 2;
            const boatBottom = boat.y + boat.height / 2;
            
            for (let obstacle of obstacles) {
                const obstLeft = obstacle.x - obstacle.width / 2;
                const obstRight = obstacle.x + obstacle.width / 2;
                const obstTop = obstacle.y - obstacle.height / 2;
                const obstBottom = obstacle.y + obstacle.height / 2;
                
                if (obstacle.type === 'rock') {
                    // Direct collision with rock
                    if (boatRight > obstLeft && boatLeft < obstRight &&
                        boatBottom > obstTop && boatTop < obstBottom) {
                        showCollisionMessage('Tu t\'es échoué ! Tu dois sûrement être un quanti...');
                        return true;
                    }
                } else if (obstacle.type === 'redBuoy') {
                    // Must pass on the right (collision if boat is on left)
                    if (boatRight < obstacle.x && 
                        boatBottom > obstTop && boatTop < obstBottom &&
                        Math.abs(boat.y - obstacle.y) < 40) {
                        showCollisionMessage('On doit passer à droite des bouées bâbord rouges ! Marin d\'eau douce !');
                        return true;
                    }
                } else if (obstacle.type === 'greenBuoy') {
                    // Must pass on the left (collision if boat is on right)
                    if (boatLeft > obstacle.x && 
                        boatBottom > obstTop && boatTop < obstBottom &&
                        Math.abs(boat.y - obstacle.y) < 40) {
                        showCollisionMessage('On doit passer à gauche des bouées tribord vertes ! Même Fred !');
                        return true;
                    }
                }
            }
            
            // Check flag collision for win
            if (flag.visible) {
                if (Math.abs(boat.x - flag.x) < 40 && 
                    Math.abs(boat.y - flag.y) < 40) {
                    gameState = 'WON';
                    document.getElementById('endBanner').classList.remove('hidden');
                    return true;
                }
            }
            
            return false;
        }
        
        function showCollisionMessage(message) {
            gameState = 'COLLISION';
            const banner = document.getElementById('collisionBanner');
            banner.innerHTML = `<p>${message}</p>`;
            banner.classList.remove('hidden');
            
            setTimeout(() => {
                startGame();
            }, 3000);
        }
        
        // Update game
        function update() {
            if (gameState !== 'PLAYING') return;
            
            // Move boat
            if (keys['ArrowLeft'] && boat.x > 30) {
                boat.x -= boat.speed;
            }
            if (keys['ArrowRight'] && boat.x < canvas.width - 30) {
                boat.x += boat.speed;
            }
            if (keys['ArrowUp'] && boat.y > 100) {
                boat.y -= boat.speed * 0.5;
            }
            if (keys['ArrowDown'] && boat.y < canvas.height - 50) {
                boat.y += boat.speed * 0.5;
            }
            
            // Move obstacles
            obstacles = obstacles.filter(obstacle => {
                obstacle.y += 3;
                
                // Count passed obstacles
                if (obstacle.y > boat.y + 50 && !obstacle.passed) {
                    obstacle.passed = true;
                    obstaclesPassed++;
                }
                
                return obstacle.y < canvas.height + 50;
            });
            
            // Create new obstacles
            if (Math.random() < 0.02 && obstacles.length < 3 && obstacleCount < 12) {
                createObstacle();
            }
            
            // Show flag after 12 obstacles
            if (obstaclesPassed >= 12 && !flag.visible) {
                flag.visible = true;
            }
            
            // Move flag down if visible
            if (flag.visible && flag.y < canvas.height / 2) {
                flag.y += 2;
            }
            
            // Move boat up to flag in end sequence
            if (flag.visible && flag.y >= canvas.height / 2 && boat.y > flag.y) {
                boat.y -= 2;
            }
            
            // Check collisions
            checkCollision();
        }
        
        // Draw game
        function draw() {
            drawSea();
            
            // Draw obstacles
            for (let obstacle of obstacles) {
                if (obstacle.type === 'rock') {
                    drawRock(obstacle.x, obstacle.y);
                } else if (obstacle.type === 'redBuoy') {
                    drawRedBuoy(obstacle.x, obstacle.y);
                } else if (obstacle.type === 'greenBuoy') {
                    drawGreenBuoy(obstacle.x, obstacle.y);
                }
            }
            
            drawFlag();
            drawBoat(boat.x, boat.y);
            
            // Draw UI
            if (gameState === 'PLAYING') {
                ctx.fillStyle = '#fff';
                ctx.font = '12px "Press Start 2P"';
                ctx.textAlign = 'left';
                ctx.fillText(`Obstacles: ${obstaclesPassed}/12`, 10, 30);
            }
        }
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === ' ' && gameState === 'START') {
                startGame();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Auto-start after 8 seconds
        autoStartTimer = setTimeout(() => {
            if (gameState === 'START') {
                startGame();
            }
        }, 8000);
        
        // Start game loop
        gameLoop();
    </script>
</body>
</html>
