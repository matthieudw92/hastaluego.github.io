<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HastaLuego - Mini Jeu Nautique</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Press Start 2P', monospace;
            background: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        #gameCanvas {
            border: 4px solid #0f0f23;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .panel {
            position: absolute;
            background: rgba(15, 15, 35, 0.95);
            border: 4px solid #ffd700;
            color: #ffffff;
            padding: 30px;
            text-align: center;
            font-size: 14px;
            line-height: 1.8;
            max-width: 600px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .panel h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .highlight {
            color: #ff6b6b;
            font-size: 16px;
            text-shadow: 2px 2px 0px #000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .space-hint {
            margin-top: 20px;
            color: #4ecdc4;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Configuration du canvas
        canvas.width = 800;
        canvas.height = 600;
        ctx.imageSmoothingEnabled = false;
        
        // Ã‰tat du jeu
        const game = {
            state: 'start',
            autoStartTimer: 0,
            boatX: canvas.width / 2,
            boatY: canvas.height * 0.7,
            boatSpeed: 4,
            scrollSpeed: 3,
            scrollOffset: 0,
            obstacles: [],
            obstacleCount: 0,
            totalObstacles: 12,
            obstacleSpawnTimer: 0,
            obstacleSpawnInterval: 120,
            finalPhase: false,
            finalBoatY: canvas.height * 0.7,
            flagY: -100,
            collisionCooldown: 0
        };
        
        // ContrÃ´les
        const keys = {};
        
        // Couleurs pixel art
        const colors = {
            sea: ['#1e3a8a', '#1e40af', '#2563eb'],
            boat: '#8b4513',
            sail: '#f5f5dc',
            rock: '#654321',
            redBuoy: '#dc2626',
            greenBuoy: '#16a34a',
            flag: '#ffd700',
            foam: '#ffffff'
        };
        
        // Audio (placeholder - sera remplacÃ© par la vraie musique)
        let music;
        function initAudio() {
            // Essayer de charger la musique depuis GitHub
            music = new Audio('hasta-luego.mp3');
            music.loop = true;
            music.volume = 0.5;
            music.play().catch(() => {
                console.log('Musique non disponible');
            });
        }
        
        // Dessiner la mer avec effet de vagues
        function drawSea() {
            const waveHeight = 20;
            const waveFreq = 0.05;
            
            for (let y = 0; y < canvas.height; y += 4) {
                const colorIndex = Math.floor((y + game.scrollOffset) / 40) % colors.sea.length;
                ctx.fillStyle = colors.sea[colorIndex];
                
                for (let x = 0; x < canvas.width; x += 4) {
                    const waveOffset = Math.sin((x * waveFreq) + (game.scrollOffset * 0.01)) * waveHeight;
                    if (y + waveOffset < canvas.height) {
                        ctx.fillRect(x, y + waveOffset, 4, 4);
                    }
                }
            }
        }
        
        // Dessiner le bateau en pixel art
        function drawBoat(x, y) {
            // Coque
            ctx.fillStyle = colors.boat;
            ctx.fillRect(x - 20, y, 40, 16);
            ctx.fillRect(x - 16, y + 16, 32, 8);
            ctx.fillRect(x - 12, y + 24, 24, 4);
            
            // MÃ¢t
            ctx.fillStyle = '#4a4a4a';
            ctx.fillRect(x - 2, y - 40, 4, 40);
            
            // Voile
            ctx.fillStyle = colors.sail;
            ctx.beginPath();
            ctx.moveTo(x + 2, y - 35);
            ctx.lineTo(x + 20, y - 20);
            ctx.lineTo(x + 2, y - 5);
            ctx.closePath();
            ctx.fill();
            
            // DÃ©tails
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(x + 4, y - 30, 12, 2);
            ctx.fillRect(x + 4, y - 20, 12, 2);
            ctx.fillRect(x + 4, y - 10, 12, 2);
        }
        
        // Dessiner un rocher
        function drawRock(x, y) {
            ctx.fillStyle = colors.rock;
            // Forme irrÃ©guliÃ¨re de rocher
            ctx.fillRect(x - 16, y - 8, 32, 16);
            ctx.fillRect(x - 20, y - 4, 40, 8);
            ctx.fillRect(x - 12, y - 12, 24, 4);
            ctx.fillRect(x - 8, y + 4, 16, 4);
            
            // Ombrage
            ctx.fillStyle = '#4a3020';
            ctx.fillRect(x + 8, y - 4, 8, 8);
            ctx.fillRect(x - 4, y + 4, 8, 4);
        }
        
        // Dessiner une bouÃ©e rouge (carrÃ©e)
        function drawRedBuoy(x, y) {
            ctx.fillStyle = colors.redBuoy;
            ctx.fillRect(x - 12, y - 12, 24, 24);
            
            // Bande rÃ©flÃ©chissante
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(x - 8, y - 8, 16, 4);
            
            // Ombre
            ctx.fillStyle = '#991b1b';
            ctx.fillRect(x + 4, y + 4, 8, 8);
        }
        
        // Dessiner une bouÃ©e verte (triangulaire)
        function drawGreenBuoy(x, y) {
            ctx.fillStyle = colors.greenBuoy;
            // Triangle pixelisÃ©
            for (let i = 0; i < 6; i++) {
                ctx.fillRect(x - 12 + i * 2, y - 12 + i * 4, 24 - i * 4, 4);
            }
            
            // Bande rÃ©flÃ©chissante
            ctx.fillStyle = '#4ade80';
            ctx.fillRect(x - 8, y - 8, 16, 4);
        }
        
        // Dessiner le drapeau d'arrivÃ©e
        function drawFlag(x, y) {
            // MÃ¢t
            ctx.fillStyle = '#4a4a4a';
            ctx.fillRect(x - 2, y, 4, 40);
            
            // Drapeau
            ctx.fillStyle = colors.flag;
            ctx.fillRect(x + 2, y, 30, 20);
            
            // Effet ondulÃ©
            ctx.fillRect(x + 32, y + 4, 4, 12);
            
            // Texte au-dessus
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px "Press Start 2P"';
            ctx.fillText('po(r)t de', x - 40, y - 20);
            ctx.fillText('dÃ©part', x - 30, y - 8);
        }
        
        // CrÃ©er un obstacle
        function createObstacle() {
            if (game.obstacleCount >= game.totalObstacles) return;
            
            const types = ['rock', 'redBuoy', 'greenBuoy'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let x;
            if (type === 'rock') {
                x = canvas.width * (0.25 + Math.random() * 0.5);
            } else if (type === 'redBuoy') {
                x = canvas.width * (0.3 + Math.random() * 0.25);
            } else {
                x = canvas.width * (0.45 + Math.random() * 0.25);
            }
            
            game.obstacles.push({
                type: type,
                x: x,
                y: -50
            });
            
            game.obstacleCount++;
        }
        
        // VÃ©rifier les collisions
        function checkCollision() {
            if (game.collisionCooldown > 0) return;
            
            for (let obstacle of game.obstacles) {
                const dx = Math.abs(game.boatX - obstacle.x);
                const dy = Math.abs(game.boatY - obstacle.y);
                
                if (obstacle.type === 'rock' && dx < 30 && dy < 25) {
                    showCollisionMessage("Tu t'es Ã©chouÃ© ! Tu dois sÃ»rement Ãªtre un quanti...");
                    resetGame();
                    return;
                }
                
                if (obstacle.type === 'redBuoy') {
                    if (game.boatX < obstacle.x && dx < 40 && dy < 25) {
                        showCollisionMessage("On doit passer Ã  droite des bouÃ©es bÃ¢bord rouges ! Marin d'eau douce !");
                        resetGame();
                        return;
                    }
                }
                
                if (obstacle.type === 'greenBuoy') {
                    if (game.boatX > obstacle.x && dx < 40 && dy < 25) {
                        showCollisionMessage("On doit passer Ã  gauche des bouÃ©es tribord vertes ! MÃªme Fred !");
                        resetGame();
                        return;
                    }
                }
            }
        }
        
        // Afficher un message de collision
        function showCollisionMessage(message) {
            const panel = document.createElement('div');
            panel.className = 'panel';
            panel.innerHTML = `<p>${message}</p>`;
            document.body.appendChild(panel);
            
            game.collisionCooldown = 180;
            
            setTimeout(() => {
                panel.remove();
            }, 3000);
        }
        
        // RÃ©initialiser le jeu
        function resetGame() {
            game.boatX = canvas.width / 2;
            game.scrollOffset = 0;
            game.obstacles = [];
            game.obstacleCount = 0;
            game.finalPhase = false;
            game.obstacleSpawnTimer = 0;
        }
        
        // Afficher le panneau de dÃ©part
        function showStartPanel() {
            const panel = document.createElement('div');
            panel.className = 'panel';
            panel.id = 'startPanel';
            panel.innerHTML = `
                <h2>âš“ HastaLuego âš“</h2>
                <p>Ã€ l'aide des touches directionnelles,<br>emmÃ¨ne ton bateau Ã  bon port !</p>
                <p class="space-hint">ESPACE pour commencer</p>
            `;
            document.body.appendChild(panel);
        }
        
        // Afficher le panneau de victoire
        function showVictoryPanel() {
            const panel = document.createElement('div');
            panel.className = 'panel';
            panel.innerHTML = `
                <h2>ðŸŽ‰ Bien jouÃ© ! ðŸŽ‰</h2>
                <p>AprÃ¨s 7 ans dans le mÃªme bateau, je vais changer d'Ã©quipage et quitter Harris pour une autre aventure.</p>
                <p>Tu as prouvÃ© ta valeur aujourd'hui ; je t'invite Ã  rejoindre de la mÃªme faÃ§on mon pot de dÃ©part le <span class="highlight">jeudi 6 novembre</span>, Ã  la cafÃ¨t, avant de se dÃ©haler vers une autre destination plus festive !</p>
            `;
            document.body.appendChild(panel);
            
            game.state = 'victory';
            if (music) music.pause();
        }
        
        // Boucle de mise Ã  jour
        function update() {
            if (game.state === 'start') {
                game.autoStartTimer++;
                if (game.autoStartTimer > 480) { // 8 secondes Ã  60fps
                    startGame();
                }
                return;
            }
            
            if (game.state !== 'playing') return;
            
            // DÃ©crÃ©menter le cooldown de collision
            if (game.collisionCooldown > 0) {
                game.collisionCooldown--;
            }
            
            // Mouvement du bateau
            if (keys['ArrowLeft'] && game.boatX > 40) {
                game.boatX -= game.boatSpeed;
            }
            if (keys['ArrowRight'] && game.boatX < canvas.width - 40) {
                game.boatX += game.boatSpeed;
            }
            if (keys['ArrowUp'] && game.boatY > 100) {
                game.boatY -= game.boatSpeed * 0.5;
            }
            if (keys['ArrowDown'] && game.boatY < canvas.height - 50) {
                game.boatY += game.boatSpeed * 0.5;
            }
            
            // Phase finale
            if (game.obstacleCount >= game.totalObstacles && !game.finalPhase) {
                game.finalPhase = true;
                game.flagY = -100;
            }
            
            if (game.finalPhase) {
                game.flagY += game.scrollSpeed;
                game.finalBoatY -= 2;
                game.boatY = Math.min(game.boatY, game.finalBoatY);
                
                // VÃ©rifier l'arrivÃ©e
                if (Math.abs(game.boatX - canvas.width / 2) < 50 && 
                    Math.abs(game.boatY - (game.flagY + 20)) < 40) {
                    showVictoryPanel();
                }
            } else {
                // DÃ©filement
                game.scrollOffset += game.scrollSpeed;
                
                // GÃ©nÃ©ration des obstacles
                game.obstacleSpawnTimer++;
                if (game.obstacleSpawnTimer >= game.obstacleSpawnInterval) {
                    createObstacle();
                    game.obstacleSpawnTimer = 0;
                }
                
                // Mise Ã  jour des obstacles
                for (let i = game.obstacles.length - 1; i >= 0; i--) {
                    game.obstacles[i].y += game.scrollSpeed;
                    
                    if (game.obstacles[i].y > canvas.height + 50) {
                        game.obstacles.splice(i, 1);
                    }
                }
                
                // VÃ©rifier les collisions
                checkCollision();
            }
        }
        
        // Boucle de rendu
        function draw() {
            // Effacer
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dessiner la mer
            drawSea();
            
            // Dessiner les obstacles
            for (let obstacle of game.obstacles) {
                switch(obstacle.type) {
                    case 'rock':
                        drawRock(obstacle.x, obstacle.y);
                        break;
                    case 'redBuoy':
                        drawRedBuoy(obstacle.x, obstacle.y);
                        break;
                    case 'greenBuoy':
                        drawGreenBuoy(obstacle.x, obstacle.y);
                        break;
                }
            }
            
            // Dessiner le drapeau en phase finale
            if (game.finalPhase) {
                drawFlag(canvas.width / 2, game.flagY);
            }
            
            // Dessiner le bateau
            drawBoat(game.boatX, game.boatY);
            
            // Indicateur de progression
            if (game.state === 'playing' && !game.finalPhase) {
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px "Press Start 2P"';
                ctx.fillText(`Obstacles: ${game.obstacleCount}/${game.totalObstacles}`, 10, 30);
            }
        }
        
        // DÃ©marrer le jeu
        function startGame() {
            const startPanel = document.getElementById('startPanel');
            if (startPanel) startPanel.remove();
            
            game.state = 'playing';
            initAudio();
            resetGame();
        }
        
        // Boucle principale
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Ã‰vÃ©nements clavier
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === ' ' && game.state === 'start') {
                startGame();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Initialisation
        showStartPanel();
        gameLoop();
    </script>
</body>
</html>
