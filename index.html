<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasta Luego</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
        }
        canvas {
            background-color: #1a1a2e;
            display: block;
        }
        #startScreen, #gameOverScreen, #winScreen {
            position: absolute;
            color: white;
            text-align: center;
            pointer-events: none;
        }
        #startScreen {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }
        #gameOverScreen, #winScreen {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            display: none;
        }
        .highlight {
            color: #ff9;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="startScreen">
        À l'aide des touches directionnelles, emmène ton bateau à bon port !<br><br>
        ESPACE pour commencer
    </div>
    <div id="gameOverScreen"></div>
    <div id="winScreen">
        Bien joué !<br><br>
        Après 7 ans dans le même bateau, je vais changer d'équipage et quitter Harris pour une autre aventure.<br>
        Tu as prouvé ta valeur aujourd'hui ; je t'invite à rejoindre de la même façon mon pot de départ le <span class="highlight">jeudi 6 novembre</span>, à la cafèt, avant de se déhaler vers une autre destination plus festive !
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const winScreen = document.getElementById('winScreen');

        // Variables de jeu
        let gameStarted = false;
        let gameOver = false;
        let gameWon = false;
        let obstacles = [];
        let score = 0;
        let obstacleSpawnRate = 120; // frames
        let frameCount = 0;
        let backgroundY = 0;
        let backgroundSpeed = 2;

        // Bateau
        const boat = {
            x: canvas.width / 2,
            y: canvas.height - canvas.height / 3,
            width: 30,
            height: 30,
            color: '#8B4513',
            sailColor: '#FFF',
            draw() {
                // Corps du bateau
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height);
                // Mât et voile
                ctx.fillStyle = this.sailColor;
                ctx.fillRect(this.x, this.y - this.height, 5, this.height);
            }
        };

        // Obstacles
        class Obstacle {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 30;
                this.color = type === 'rock' ? '#8B4513' : type === 'redBuoy' ? '#FF0000' : '#00FF00';
                this.shape = type === 'rock' ? 'circle' : type === 'redBuoy' ? 'square' : 'triangle';
            }
            draw() {
                ctx.fillStyle = this.color;
                if (this.shape === 'circle') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.shape === 'square') {
                    ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height);
                } else if (this.shape === 'triangle') {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y - this.height / 2);
                    ctx.lineTo(this.x - this.width / 2, this.y + this.height / 2);
                    ctx.lineTo(this.x + this.width / 2, this.y + this.height / 2);
                    ctx.closePath();
                    ctx.fill();
                }
            }
        }

        // Drapeau
        const flag = {
            x: canvas.width / 2,
            y: 50,
            width: 20,
            height: 30,
            color: '#FFFF00',
            draw() {
                // Mât du drapeau
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x, this.y, 5, this.height);
                // Drapeau
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x + 5, this.y, this.width, this.height / 2);
            }
        };

        // Fonction pour générer des obstacles
        function generateObstacle() {
            const types = ['rock', 'redBuoy', 'greenBuoy'];
            const type = types[Math.floor(Math.random() * types.length)];
            let x, minX, maxX;

            switch(type) {
                case 'rock':
                    minX = canvas.width * 0.25;
                    maxX = canvas.width * 0.75;
                    break;
                case 'redBuoy':
                    minX = canvas.width * 0.3;
                    maxX = canvas.width * 0.55;
                    break;
                case 'greenBuoy':
                    minX = canvas.width * 0.45;
                    maxX = canvas.width * 0.7;
                    break;
            }

            x = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
            const y = -30;
            obstacles.push(new Obstacle(type, x, y));
        }

        // Fonction pour vérifier les collisions
        function checkCollisions() {
            for (let i = 0; i < obstacles.length; i++) {
                const obstacle = obstacles[i];
                if (boat.x + boat.width / 2 > obstacle.x - obstacle.width / 2 &&
                    boat.x - boat.width / 2 < obstacle.x + obstacle.width / 2 &&
                    boat.y + boat.height / 2 > obstacle.y - obstacle.height / 2 &&
                    boat.y - boat.height / 2 < obstacle.y + obstacle.height / 2) {
                    return true;
                }

                // Vérification des bouées rouges
                if (obstacle.type === 'redBuoy' && boat.x - boat.width / 2 < 0) {
                    gameOverScreen.textContent = 'on doit passer à droite des bouées bâbord rouges ! Marin d\'eau douce !';
                    return true;
                }

                // Vérification des bouées vertes
                if (obstacle.type === 'greenBuoy' && boat.x + boat.width / 2 > canvas.width) {
                    gameOverScreen.textContent = 'on doit passer à gauche des bouées tribord vertes ! Même Fred !';
                    return true;
                }
            }
            return false;
        }

        // Fonction pour dessiner le jeu
        function drawGame() {
            // Effacer le canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dessiner l'arrière-plan (mer avec vagues)
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dessiner les vagues
            ctx.fillStyle = '#1e88e5';
            for (let i = 0; i < canvas.height; i += 20) {
                ctx.fillRect(0, backgroundY + i, canvas.width, 10);
            }

            // Mettre à jour la position de l'arrière-plan pour donner l'impression que le bateau avance
            backgroundY = (backgroundY + backgroundSpeed) % 20;

            // Dessiner les obstacles
            for (let i = 0; i < obstacles.length; i++) {
                obstacles[i].draw();
                obstacles[i].y += 2;

                // Supprimer les obstacles hors de l'écran
                if (obstacles[i].y > canvas.height) {
                    obstacles.splice(i, 1);
                    score++;
                }
            }

            // Dessiner le bateau
            boat.draw();

            // Dessiner le drapeau
            if (score >= 12) {
                flag.draw();
            }

            // Vérifier si le bateau a atteint le drapeau
            if (score >= 12 && boat.y + boat.height / 2 <= flag.y + flag.height) {
                gameWon = true;
                gameOver = true;
                winScreen.style.display = 'block';
            }
        }

        // Fonction pour mettre à jour le jeu
        function updateGame() {
            if (!gameStarted) return;

            frameCount++;
            if (frameCount % obstacleSpawnRate === 0) {
                generateObstacle();
            }

            if (checkCollisions()) {
                gameOver = true;
                gameOverScreen.style.display = 'block';
            }

            drawGame();

            if (!gameOver) {
                requestAnimationFrame(updateGame);
            }
        }

        // Gestion des touches
        document.addEventListener('keydown', (e) => {
            if (!gameStarted && (e.code === 'Space' || e.key === ' ')) {
                gameStarted = true;
                startScreen.style.display = 'none';
                updateGame();
            }

            if (gameStarted && !gameOver) {
                switch(e.key) {
                    case 'ArrowLeft':
                        boat.x -= 10;
                        if (boat.x - boat.width / 2 < 0) boat.x = boat.width / 2;
                        break;
                    case 'ArrowRight':
                        boat.x += 10;
                        if (boat.x + boat.width / 2 > canvas.width) boat.x = canvas.width - boat.width / 2;
                        break;
                }
            }

            if (gameOver && (e.code === 'Space' || e.key === ' ')) {
                // Réinitialiser le jeu
                gameStarted = false;
                gameOver = false;
                gameWon = false;
                obstacles = [];
                score = 0;
                frameCount = 0;
                startScreen.style.display = 'block';
                gameOverScreen.style.display = 'none';
                winScreen.style.display = 'none';
                boat.x = canvas.width / 2;
                boat.y = canvas.height - canvas.height / 3;
            }
        });

        // Démarrer le jeu après 8 secondes si aucune action
        setTimeout(() => {
            if (!gameStarted) {
                gameStarted = true;
                startScreen.style.display = 'none';
                updateGame();
            }
        }, 8000);
    </script>
</body>
</html>
